<!doctype html>
<html>
<head>
    <title>Beer League Baseball Challenge</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta charset="UTF-8">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" type="text/css" href="css/bootstrap-form.css">
    <!-- Javascript -->
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.validate.js"></script>
    <script>
     $(document).ready(function() {
      // Declare Variables
      var league_array = [];
      var team_num = 0;
      var sched4 = [ 
        [ [1, 4], [2, 3] ],
        [ [1, 3], [2, 4] ],
        [ [1, 2], [3, 4] ]
      ];

      var sched6 = [ 
        [ [1, 6], [2, 5], [3, 4] ],
        [ [1, 5], [4, 6], [2, 3] ],
        [ [1, 4], [3, 5], [2, 6] ],
        [ [1, 3], [2, 4], [5, 6] ],
        [ [1, 2], [3, 6], [4, 5] ],
      ];

      var sched8 = [
        [ [1, 8], [2, 7], [3, 6], [4, 5] ],
        [ [1, 7], [6, 8], [2, 5], [3, 4] ],
        [ [1, 6], [5, 7], [4, 8], [2, 3] ],
        [ [1, 5], [4, 6], [3, 7], [2, 8] ],
        [ [1, 4], [3, 5], [2, 6], [7, 8] ],
        [ [1, 3], [2, 4], [5, 8], [6, 7] ],
        [ [1, 2], [3, 8], [4, 7], [5, 6] ],
      ];

      $.ajax({type: 'GET', url: 'backliftapp/team', success: function (data) {
       league_array = data; 
       printTeam(data); // populates table on load   
      }});

      function printTeam(data){     //populates table on load. Contains popover content. 
        $('#teamTable').html(''); 
        for (var index = 0; index < data.length; index++) { 
          $('<tr id="' + data[index].id + '"><td><a rel="popover" data-toggle="popover" title="<h4 style=\'text-align: center;\'>' + data[index].teamName + '</h4>"  data-content="<table id=\'contact_pop\'><tr><td>Manager: </td><td>' + data[index].firstName + " " + data[index].lastName + '</td></tr><tr><td>Phone:</td><td>' + data[index].phoneNumber + '</td></tr><tr><td>Sponsor:</td><td>' + data[index].sponsor + '</td></tr><tr><td>Zip:</td><td>' + data[index].zip +'</td></tr></table>">' + data[index].teamName + '</a><button type="button" class="close deleteTeam" style="margin-right: 10px;">&times;</button></td><td>' + data[index].wins + '</td><td>' + data[index].losses + '</td><td>' + 1234 + '</td></tr>').appendTo('#teamTable');
            };
      }; //end printTeam func

      //Button to delete team
      $('table').on('click', '.deleteTeam', function() {
        $.ajax({
          type: 'DELETE', 
          url: 'backliftapp/team/' + $(this).closest('tr').attr('id')
        }); //end ajax delete
        $(this).closest('tr').remove();
      }); //end delete team click

      //form validation
      var validate = $("#modal_form").validate({
        rules: {
          teamName: {
            minlength: 2,
            required: true
          },
          firstName: {
            minlength: 2,
            required: true
          },
          lastName: {
            minlength: 2,
            required: true
          },
          phoneNumber: {
            digits: true,
            required: true,
            rangelength: [10, 10]
          },
          sponsor: {
            minlength: 2,
            required: true
          },
          zip: {       
            digits: true,
            required: true,
            rangelength: [5, 5]
          }
        },
        highlight: function(element) {
          $(element).closest('.control-group').removeClass('success').addClass('error');
        },
        success: function(element) {
          element
          .text('Valid').addClass('valid')
          .closest('.control-group').removeClass('error').addClass('success');
        }
      }); //end validation
      
      // Verify if form is valid
      function validForm() {
        $('.control-group').each(function() {
          if ($(this).hasClass('error')) {
            
            return false;
          }
        });
      };

      // function to add all teams to the schedule
      function addTeam(team_array) {
        $('#teamTable').append("<tr><td>" + team_array[0] + "</td><td>" + 0 + "</td><td>" + 0 + "</td><td>" + 0 + "</td></tr>");
      };

      //function to clear the team input form
      function clearForm() {
        $('.teamInput').each(function() {
          $(this).val("");
        });
      };

      //function to test stuff and things
      $('#modalSubmit').click(function(){
          $.ajax({
           type: "POST",
           url: "backliftapp/team",
           dataType: "json",
           data: {
              "teamName": $('#teamName').val(),
              "firstName": $('#firstName').val(),
              "lastName": $('#lastName').val(),
              "phoneNumber": $('#phoneNumber').val(),
              "sponsor": $('#sponsor').val(),
              "zip": $('#zip').val(),
              "wins": 0,
              "losses": 0
           },
           success: function (data) {
             league_array.push(data);
           }
          }); //end ajax post
      });//end test click

     }); //end document ready
    </script>
</head>
<body>
<div class="container-fluid">
 <div class="span12 wrapper">
  <h1>Beer League Baseball Challenge</h1>

  <div class="tableWrap">
   <table class="table table-striped table-bordered">
    <caption>Standings</caption>
    <thead>
     <tr>
      <th>Team</th>
      <th>W</th>
      <th>L</th>
      <th>%</th>
     </tr>
    </thead>
    <tbody id="teamTable">
    </tbody>
   </table>     
  </div>

  <!-- Button to trigger modal -->
  <a href="#myModal" role="button" class="btn" data-toggle="modal">Add a Team</a>
  <button id="test" type="submit" class="btn" onclick="return false">test</button>
  <!-- Modal -->
  <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel">Team Information</h3>
   </div>
   <div class="modal-body">
    <form id="modal_form" class="form-horizontal">
     <div class="control-group">
       <label class="control-label" for="teamName">Team Name</label>
       <div class="controls">
         <input name="teamName" type="text" id="teamName" class="teamInput" placeholder="Team Name">
       </div>
     </div>
     <div class="control-group">
       <label class="control-label" for="firstName">Manager First Name</label>
       <div class="controls">
         <input name="firstName" type="text" id="firstName" class="teamInput" placeholder="Manager First Name">
       </div>
     </div>
     <div class="control-group">
       <label class="control-label" for="lastName">Manager Last Name</label>
       <div class="controls">
         <input name="lastName" type="text" id="lastName" class="teamInput" placeholder="Manager Last Name">
       </div>
     </div>
     <div class="control-group">
       <label class="control-label" for="inputPhoneNumber">Phone Number</label>
       <div class="controls">
         <input name="phoneNumber" type="text" id="phoneNumber" class="teamInput" placeholder="Phone Number">
       </div>
     </div>
     <div class="control-group">
       <label class="control-label" for="sponsor">Sponsor</label>
       <div class="controls">
         <input name="sponsor" type="text" id="sponsor" class="teamInput" placeholder="Sponsor">
       </div>
     </div>
     <div class="control-group">
       <label class="control-label" for="zip">Zip Code</label>
       <div class="controls">
         <input name="zip" type="text" id="zip" class="teamInput" placeholder="Zip Code">
       </div>
     </div>
     <div class="controls">
       <button id="modalSubmit" type="submit" class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Submit</button>
       <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
     </div>
    </form> 
   </div>
<!--    <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    <button class="btn btn-primary">Save changes</button>
   </div> -->
  </div> <!-- End Modal -->
 </div> <!-- End Wrapper -->
</div> <!-- End Container -->
<div id="value"></div>
<script type="text/javascript">

  $('body').popover({
    selector: '[rel=popover]',
      html:  true,
        trigger: 'hover',
        placement: 'bottom'
    });

</script>
</body>
</html>